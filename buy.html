<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Su Squares, buy a square</title>
  <link rel="canonical" href="https://tenthousandsu.com/buy" />
  <link rel="stylesheet" href="assets/main.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.3.4/dist/web3.min.js" integrity="sha256-GQqI2JYavfgCtKq7m7vTVLWIudbQ76HvNgxy4n8V9dc=" crossorigin="anonymous"></script>
  <script src="assets/main.js"></script>
</head>
<body>
  <header>
    <a id="logo" href="/"><img src="assets/logo-su-squares.svg" style="width:348px;height:57px;object-fit: cover;"></div></a>
  </header>

  <article class="lead">
    <h1>Buy Su Squares <span class="square-number-with-number-sign"></span></h1>
    <p><em>If you have any questions, please mail <a href="mailto:Su@TenThousandSu.com?subject=Sales%20question&body=HiSu,%20Please%20help!%20I%20have%20a%20question%20about%20Su%20Squares.">Su@TenThousandSu.com</a>.</em></p>
    <p><em>Some Squares are available for <a href="buy-with-paypal">purchase with PayPal</a>.</em></p>

    <div id="pick-a-square" style="display:none">
      <h2>Which Square would you like?</h2>
      <form>
        <p><strong>Square number</strong></p>
        <select id="square-number"></select>
      </form>
      <button id="continue" type="button">Continue</button>
    </div>

    <div id="buy-selected-square" style="display:none">
      <div class="step-1-not-done">
        <h2>Step 1: Install MetaMask</h2>
        <p>To purchase using Ether use Edge/Chrome/Firefox/Opera and <a target="_blank" href="https://metamask.io/">Install MetaMask</a> or compatible software to continue. Then reload this page.</p>
      </div>
      <div class="step-1-done" style="display:none">
        <p>&#x2705; Step 1: Web3 environment enabled</p>
      </div>
  
      <div class="step-2-not-done">
        <h2>Step 2: Login to Mainnet</h2>
        <p>Switch to <strong>Ethereum Mainnet</strong> and login to your MetaMask wallet. Then reload this page.</p>
      </div>
      <div class="step-2-done" style="display:none">
        <p>&#x2705; Step 2: Using Ethereum<sup>&reg;</sup> Mainnet</p>
      </div>
  
      <div class="step-2-done" style="display:none">
        <button id="buy" type="button">Buy Square</button>
      </div>
  
      <div class="step-3-done" style="display:none">
        <h2>Step 4: Processing...</h2>
        <p>Thank you for your purchase! You picked <strong>Square <span class="square-number-with-number-sign"></span></strong>.</p>
        <p>Your purchase is processing, your transaction ID is <a target="_blank" id="txlink" href=""><strong id="transaction-id-plug"></strong></a></p>
        <p>You can click that link about to check the progress. This should complete within one minute. (It will say "sorry, unable to locate" until then.)</p>
        <p>After the transaction is complete you own the square! Your Ethereum wallet will show it to you if your wallet has built-in support for ERC-721. Otherwise, write down your square number and you can use that to personalize.</p>
      </div>
    </div>

  </article>

  <footer>
    <small>
      To the extent possible under law, Su Entriken has waived all copyright and related or neighboring rights to the TenThousandSu.com website. This work is published from the United States.
    </small>
  </footer>

  <script>
    const app = new SuSquaresApplication();

    /* Dynamic data on page ***************************************************/
    $.get("/build/squarePersonalizations.json", function(data){
      const allData = [""].concat(data); // Data is zero-indexed
      for (let squareNumber = 1; squareNumber<=10000; squareNumber++) {
        const square = allData[squareNumber];
        if (square !== null) { // Available
          $("#square-number").append(
            $("<option>").text(squareNumber)
          );
        }
      }
    });

    /* The Web3 workflow ******************************************************/
    app.isConnected.then(()=>{
      $(".step-1-not-done").hide();
      $(".step-1-done").show();
    });

    app.isNetworkCorrect.then(()=>{
      $(".step-2-not-done").hide();
      $(".step-2-done").show();
    });

    /* Buy page interactivity *************************************************/
    $(()=>{
      let squareNumber = app.getSquareFromUrl();

      if (squareNumber) {
        $(".square-number-with-number-sign").text("#" + squareNumber);
        $("#buy-selected-square").show();
      } else {
        $("#pick-a-square").show();
      }

      // The CONTINUE button
      $("#continue").on("click", async ()=>{
        let squareNumber = $("#square-number").val();
        if (squareNumber != parseInt(squareNumber)) {
          return alert("Please enter an available Square number between 1 and 10,000.");
        }
        if (squareNumber < 1) {
          return alert("Please enter an available Square number between 1 and 10,000.");
        }
        if (squareNumber > 10000) {
          return alert("Please enter an available Square number between 1 and 10,000.");
        }
        $(".square-number-with-number-sign").text("#" + squareNumber);
        $("#pick-a-square").hide();
        $("#buy-selected-square").show();
      });

      // The BUY SQUARE button
      $("#buy").on("click", async ()=>{
        $("#nextlink").attr("href", "personalize?square=" + squareNumber)

        app.sendBuy(squareNumber)
        .then(receipt=>{
          console.log(receipt);
          $(".step-3-done").show();
          $(".step-3-not-done").hide();
          $("#transaction-id-plug").text(receipt.transactionHash);
          $("#txlink").attr("href", "https://etherscan.io/tx/" + receipt.transactionHash)
        })
        .catch(error=>{
          console.log(error.message);
          alert(error.message);
        });
      });
    });
  </script>

</body>
</html>
