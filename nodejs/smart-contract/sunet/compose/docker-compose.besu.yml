services:
  besu:
    image: hyperledger/besu:25.11.0
    container_name: sunet-besu
    command: >
      --data-path=/data
      --genesis-file=/config/genesis.json
      --rpc-http-enabled
      --rpc-http-host=0.0.0.0
      --rpc-http-port=${RPC_PORT:-8545}
      --rpc-http-api=ETH,NET,WEB3,DEBUG,TRACE,TXPOOL
      --rpc-ws-enabled
      --rpc-ws-host=0.0.0.0
      --rpc-ws-port=${RPC_WS_PORT:-8546}
      --rpc-ws-api=ETH,NET,WEB3,DEBUG,TRACE,TXPOOL
      --host-allowlist=*
      --rpc-http-cors-origins=*
      --p2p-port=${P2P_PORT:-30303}
      --p2p-host=0.0.0.0
      --discovery-enabled=false
      --min-gas-price=0
      --sync-mode=FULL
      --data-storage-format=FOREST
      --node-private-key-file=/config/keys/validator.key
      --logging=INFO
    volumes:
      - ../data/besu:/data
      - ../config:/config:ro
    ports:
      - "${RPC_PORT:-8545}:8545"
      - "${RPC_WS_PORT:-8546}:8546"
      - "${P2P_PORT:-30303}:30303"
    environment:
      - LOCAL_CHAIN_ID=${LOCAL_CHAIN_ID:-1337}
      - BLOCK_TIME=${BLOCK_TIME:-5}
    networks:
      - sunet

networks:
  sunet:
    driver: bridge
